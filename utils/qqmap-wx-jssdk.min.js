var QQMapWX = function (options) {
    if (!options.key) {
        throw Error('key值不能为空');
    }
    this.key = options.key;
};

QQMapWX.prototype.request = function (options) {
    var that = this;
    options = options || {};
    options.data = options.data || {};
    options.header = options.header || {};
    if (typeof options.fail !== 'function') {
        options.fail = function () { };
    }
    if (typeof options.success !== 'function') {
        options.success = function () { };
    }
    // 设置请求参数
    options.data.key = this.key;

    wx.request({
        url: 'https://apis.map.qq.com/ws/' + options.path,
        data: options.data,
        header: options.header,
        method: options.method || 'GET',
        success: function (res) {
            var response = res.data;
            // 处理API返回值
            if (response.status === 0) {
                options.success(response);
            } else {
                var error = 'request failed: ' + response.status;
                options.fail(error);
            }
        },
        fail: function (res) {
            options.fail(res);
        },
        complete: function (res) {
            if (options.complete) {
                options.complete(res);
            }
        }
    });
};

// 地点搜索接口
QQMapWX.prototype.search = function (options) {
    var options = options || {};
    options.path = 'place/v1/search';
    this.request(options);
};

// 地址解析接口
QQMapWX.prototype.geocoder = function (options) {
    var options = options || {};
    options.path = 'geocoder/v1/';
    this.request(options);
};

// 逆地址解析接口
QQMapWX.prototype.reverseGeocoder = function (options) {
    var options = options || {};
    options.path = 'geocoder/v1/';
    options.data = options.data || {};
    options.data.get_poi = options.get_poi || 0;
    this.request(options);
};

// 计算距离接口
QQMapWX.prototype.calculateDistance = function (options) {
    var options = options || {};
    options.path = 'distance/v1/';
    options.data = options.data || {};
    options.data.mode = options.mode || 'walking';
    this.request(options);
};

// 路线规划接口
QQMapWX.prototype.direction = function (options) {
    var options = options || {};
    options.path = 'direction/v1/' + options.mode;
    options.data = options.data || {};
    options.data.output = 'json';
    this.request(options);
};

// 获取POI详情接口
QQMapWX.prototype.getPoiDetail = function (options) {
    var options = options || {};
    options.path = 'place/v1/detail';
    this.request(options);
};

module.exports = QQMapWX; 